<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Estate Plan</title>

<style>
:root{
  --jam-dark:#2b1417;
  --jam-mid:#4a1f26;
  --paper:#ffffff;
  --border:#d2d6da;
  --heading:#2f4f4f;
  --muted:#6b7280;
  --soft:#f7f8fa;
}

/* ===== SCREEN ===== */
body{
  margin:0;
  font-family:"Times New Roman", Georgia, serif;
  background:radial-gradient(circle at top, var(--jam-mid), var(--jam-dark));
  color:#1f2933;
}

.container{
  max-width:1100px;
  margin:50px auto;
  padding:40px 30px 120px;
  background:var(--paper);
  border-radius:16px;
  box-shadow:0 20px 45px rgba(0,0,0,0.35);
  position:relative;
}

h1{
  text-align:center;
  margin:0;
  color:var(--heading);
  letter-spacing:0.4px;
}

.subtitle{
  text-align:center;
  font-size:14px;
  color:var(--muted);
  margin:8px 0 0;
  line-height:1.5;
}

.notice{
  background:var(--soft);
  border:1px solid var(--border);
  border-radius:10px;
  padding:14px 16px;
  font-size:14px;
  line-height:1.6;
  margin:18px 0 24px;
  color:#374151;
}

.toolbar{
  display:flex;
  justify-content:center;
  gap:10px;
  margin:22px 0 18px;
  flex-wrap:wrap;
}

button{
  padding:9px 14px;
  font-family:inherit;
  font-size:14px;
  border-radius:6px;
  border:1px solid var(--border);
  background:#f9fafb;
  cursor:pointer;
}
button:hover{ background:#eef2f5; }

section{
  border:1px solid var(--border);
  border-radius:10px;
  margin-bottom:18px;
  background:#fff;
}

.section-header{
  padding:16px 20px;
  border-bottom:1px solid var(--border);
}

.section-header h2{
  margin:0;
  font-size:17px;
  color:var(--heading);
}

.section-content{ padding:20px; }

.help{
  font-size:13.5px;
  color:var(--muted);
  line-height:1.6;
  margin:0 0 12px;
}

.grid-2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
@media (max-width:820px){
  .grid-2{ grid-template-columns:1fr; }
}

input, textarea{
  width:100%;
  padding:10px;
  margin-bottom:12px;
  border-radius:6px;
  border:1px solid var(--border);
  background:#fafafa;
  font-family:inherit;
  font-size:14px;
  box-sizing:border-box;
}

.large-note{ min-height:220px; }
.medium-note{ min-height:140px; }

/* ===== PRINT DOCUMENT PAGES (Cover/TOC/Summary) ===== */
.print-only{ display:none; }

.print-page{
  padding:18mm 18mm 24mm;
  page-break-after:always;
}

.print-title{
  text-align:center;
  margin-top:40mm;
}

.print-title h1{
  font-size:34px;
  margin-bottom:8px;
}

.print-sub{
  text-align:center;
  font-size:13px;
  color:#444;
  margin-top:10px;
}

.toc{
  font-size:13.5px;
}
.toc ol{
  padding-left:18px;
}

.family-box{
  border:1px solid #ccc;
  padding:12px 14px;
  margin:10px 0;
  font-size:13.5px;
  line-height:1.55;
}

/* This is the magic print-safe text style */
.print-text{
  white-space:pre-wrap;
  font-size:12pt;
  line-height:1.45;
  margin:0 0 10px;
  color:#111827;
}

.print-label{
  font-weight:700;
  margin:10px 0 4px;
  color:#111827;
}

/* ===== PRINT FOOTER PAGE NUMBERS ===== */
@media print{
  body{ background:#fff; }
  .container{ display:none !important; }
  .print-only{ display:block !important; }

  @page{ margin:18mm 18mm 24mm; }

  footer{
    position:fixed;
    bottom:8mm;
    left:0;
    right:0;
    text-align:center;
    font-size:11px;
    color:#555;
  }

  footer:after{
    content:"Page " counter(page);
  }
}
</style>
</head>

<body>

<!-- ================= PRINT: COVER ================= -->
<div class="print-only print-page">
  <div class="print-title">
    <h1>My Estate Plan</h1>
    <div style="margin-top:22px;font-size:14px;">
      <div><b>Prepared for:</b> <span id="coverName">—</span></div>
      <div style="margin-top:6px;"><b>Jurisdiction:</b> <span id="coverCountry">—</span></div>
      <div style="margin-top:6px;"><b>Date:</b> <span id="coverDate">—</span></div>
      <div style="margin-top:6px;"><b>Version:</b> 1.0</div>
    </div>
    <p class="print-sub">
      This document is a personal planning record intended to assist family and executors.
      It is not a legal will.
    </p>
  </div>
</div>

<!-- ================= PRINT: TABLE OF CONTENTS ================= -->
<div class="print-only print-page toc">
  <h2>Table of Contents</h2>
  <ol id="tocList"></ol>
</div>

<!-- ================= PRINT: FAMILY SUMMARY ================= -->
<div class="print-only print-page">
  <h2>What To Do First</h2>

  <div class="family-box"><b>1. Do not rush.</b><br>Take time. Nothing must be decided immediately.</div>
  <div class="family-box"><b>2. Locate key documents.</b><br>Use the “Important Documents” section in this binder.</div>
  <div class="family-box"><b>3. Contact the executor.</b><br>The executor named in this document should guide next steps.</div>
  <div class="family-box"><b>4. Secure property & valuables.</b><br>Protect homes, vehicles, pets, and important items.</div>
  <div class="family-box"><b>5. Do not distribute assets early.</b><br>Wait for proper legal guidance.</div>
  <div class="family-box"><b>6. Seek professional advice.</b><br>Laws vary by jurisdiction. A lawyer/advisor may be required.</div>

  <h3 style="margin-top:18px;">Family Notes</h3>
  <div class="print-text" id="familyNotesPrint">—</div>
</div>

<footer class="print-only">My Estate Plan · </footer>

<!-- ================= SCREEN APP ================= -->
<div class="container" id="screenDoc">

  <h1>My Estate Plan</h1>
  <p class="subtitle">Personal planning record for family and executors · Not a legal document</p>

  <div class="toolbar">
    <button onclick="window.print()">Print / Save PDF</button>
    <button onclick="exportWord()">Download Word</button>
    <button onclick="downloadBackup()">Backup</button>
    <button onclick="importBackup()">Restore</button>
  </div>

  <div class="notice">
    <b>Privacy:</b> Your entries are saved locally in this browser on this device.
    Use <b>Print / Save PDF</b> and/or <b>Backup</b> to share with family/executors.
  </div>

  <section data-section>
    <div class="section-header"><h2>Personal Information</h2></div>
    <div class="section-content">
      <p class="help">Basic identification details for this binder cover and for reference.</p>
      <div class="grid-2">
        <input id="name" data-key="name" placeholder="Full legal name">
        <input id="dob" data-key="dob" placeholder="Date of birth (YYYY-MM-DD)">
      </div>
      <input id="address" data-key="address" placeholder="Primary residence address">
      <div class="grid-2">
        <input id="phone" data-key="phone" placeholder="Telephone number">
        <input id="email" data-key="email" placeholder="Email address">
      </div>
      <input id="country" data-key="country" placeholder="Country / jurisdiction (e.g., Canada, United States)">
    </div>
  </section>

  <section data-section>
    <div class="section-header"><h2>Executor</h2></div>
    <div class="section-content">
      <p class="help">The executor manages the estate process under local law.</p>
      <div class="grid-2">
        <input data-key="ex_name" placeholder="Primary executor name">
        <input data-key="ex_phone" placeholder="Executor phone">
      </div>
      <textarea class="large-note" data-key="ex_instructions" placeholder="Executor instructions, key contacts, guidance"></textarea>
    </div>
  </section>

  <section data-section>
    <div class="section-header"><h2>Important Documents</h2></div>
    <div class="section-content">
      <p class="help">Where originals and key records are located.</p>
      <textarea class="large-note" data-key="docs" placeholder="Location of will, insurance policies, titles, deeds, tax returns, pension statements, etc."></textarea>
    </div>
  </section>

  <section data-section>
    <div class="section-header"><h2>Assets</h2></div>
    <div class="section-content">
      <p class="help">List major assets (property, bank/investments, vehicles, valuables).</p>
      <textarea class="large-note" data-key="assets" placeholder="Assets list + notes"></textarea>
    </div>
  </section>

  <section data-section>
    <div class="section-header"><h2>Final Wishes</h2></div>
    <div class="section-content">
      <p class="help">Funeral, burial/cremation, memorial wishes, and personal notes.</p>
      <textarea class="large-note" data-key="final_wishes" placeholder="Final wishes"></textarea>
    </div>
  </section>

  <section data-section>
    <div class="section-header"><h2>Family “What To Do First” Notes</h2></div>
    <div class="section-content">
      <p class="help">Editable notes for family (keys, pets, who to call, urgent instructions).</p>
      <textarea id="familyNotes" class="large-note" data-key="family_notes"
        placeholder="Keys location, pet care, immediate contacts, urgent instructions..."></textarea>
    </div>
  </section>

</div>

<script>
/* =========================
   LOCAL SAVE (so you don't lose work)
========================= */
const STORE = "estate_plan_complete_v1";
const fields = Array.from(document.querySelectorAll("[data-key]"));

function saveLocal(){
  const payload = {};
  fields.forEach(el => payload[el.dataset.key] = el.value || "");
  localStorage.setItem(STORE, JSON.stringify(payload));
}

function loadLocal(){
  const raw = localStorage.getItem(STORE);
  if(!raw) return;
  try{
    const payload = JSON.parse(raw);
    fields.forEach(el => { el.value = payload[el.dataset.key] || ""; });
  }catch(e){}
}

fields.forEach(el => el.addEventListener("input", saveLocal));
loadLocal();

/* =========================
   PRINT: Cover + TOC + Family Notes
   PLUS: convert all inputs/textareas to flowing text
   so long text NEVER clips in PDF.
========================= */
function buildTOC(){
  const toc = document.getElementById("tocList");
  toc.innerHTML = "";
  document.querySelectorAll("[data-section] .section-header h2").forEach((h, i)=>{
    const li = document.createElement("li");
    li.textContent = h.textContent;
    toc.appendChild(li);
  });
}

function fillCoverAndSummary(){
  document.getElementById("coverName").textContent = document.getElementById("name").value || "—";
  document.getElementById("coverCountry").textContent = document.getElementById("country").value || "—";
  document.getElementById("coverDate").textContent = new Date().toLocaleDateString();
  document.getElementById("familyNotesPrint").textContent = document.getElementById("familyNotes").value || "—";
}

function convertFieldsForPrint(){
  // Replace each input/textarea in the SCREEN doc with print-friendly text blocks (temporarily)
  document.querySelectorAll("#screenDoc input, #screenDoc textarea").forEach(el=>{
    const label = el.placeholder ? el.placeholder.trim() : "";
    const value = (el.value || "").trim();

    const wrapper = document.createElement("div");
    wrapper.dataset.printReplace = "1";

    if(label){
      const lbl = document.createElement("div");
      lbl.className = "print-label";
      lbl.textContent = label;
      wrapper.appendChild(lbl);
    }

    const txt = document.createElement("div");
    txt.className = "print-text";
    txt.textContent = value || "—";
    wrapper.appendChild(txt);

    // Insert wrapper before the element, then hide element
    el.parentNode.insertBefore(wrapper, el);
    el.dataset.printHidden = "1";
    el.style.display = "none";
  });
}

function restoreAfterPrint(){
  document.querySelectorAll("[data-print-replace]").forEach(n => n.remove());
  document.querySelectorAll("#screenDoc input[data-print-hidden], #screenDoc textarea[data-print-hidden]").forEach(el=>{
    el.style.display = "";
    el.removeAttribute("data-print-hidden");
  });
}

window.addEventListener("beforeprint", ()=>{
  saveLocal();
  fillCoverAndSummary();
  buildTOC();
  convertFieldsForPrint();
});

window.addEventListener("afterprint", restoreAfterPrint);

/* =========================
   WORD/DOC EXPORT
   Exports a clean doc with headings and printed text.
========================= */
function exportWord(){
  // Create a Word-friendly HTML document using the same content as the screen binder
  // We convert form fields into readable text blocks so Word looks clean.
  const clone = document.getElementById("screenDoc").cloneNode(true);

  // Remove toolbar buttons from export
  const tb = clone.querySelector(".toolbar");
  if(tb) tb.remove();

  // Convert fields to text
  clone.querySelectorAll("input,textarea").forEach(el=>{
    const label = el.placeholder ? el.placeholder.trim() : "";
    const value = (el.value || "").trim();

    const wrap = document.createElement("div");
    if(label){
      const b = document.createElement("div");
      b.style.fontWeight = "700";
      b.style.marginTop = "10px";
      b.textContent = label;
      wrap.appendChild(b);
    }
    const p = document.createElement("div");
    p.style.whiteSpace = "pre-wrap";
    p.style.marginBottom = "8px";
    p.textContent = value || "—";
    wrap.appendChild(p);

    el.parentNode.replaceChild(wrap, el);
  });

  const html = `
  <html>
    <head>
      <meta charset="UTF-8">
      <title>My Estate Plan</title>
    </head>
    <body style="font-family:Times New Roman, Georgia, serif;">
      ${clone.outerHTML}
    </body>
  </html>`;

  const blob = new Blob(['\ufeff', html], { type: 'application/msword' });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "My_Estate_Plan.doc";
  a.click();
}

/* =========================
   BACKUP / RESTORE (JSON)
========================= */
function downloadBackup(){
  const payload = {};
  fields.forEach(el => payload[el.dataset.key] = el.value || "");
  const blob = new Blob([JSON.stringify({version:"1.0", saved:new Date().toISOString(), payload}, null, 2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "my-estate-plan-backup.json";
  a.click();
}

function importBackup(){
  const input = document.createElement("input");
  input.type = "file";
  input.accept = ".json,application/json";
  input.onchange = async ()=>{
    const file = input.files?.[0];
    if(!file) return;
    try{
      const text = await file.text();
      const parsed = JSON.parse(text);
      const payload = parsed?.payload || {};
      fields.forEach(el => { el.value = payload[el.dataset.key] || ""; });
      saveLocal();
      alert("Restore complete.");
    }catch(e){
      alert("That backup file could not be read.");
    }
  };
  input.click();
}
</script>

</body>
</html>
