<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Estate Plan</title>

<style>
:root{
  --page-bg:#2b1b1f;
  --card-bg:#ffffff;
  --border:#cfd3d6;
  --primary:#2f4f4f;
  --muted:#6a737d;
}

body{
  margin:0;
  font-family:"Times New Roman", Georgia, serif;
  background:var(--page-bg);
  color:#1f2a33;
}

#watermark{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%) rotate(-30deg);
  font-size:120px;
  font-weight:700;
  color:rgba(0,0,0,0.08);
  pointer-events:none;
}

.container{
  max-width:1100px;
  margin:40px auto;
  padding:32px 22px 90px;
  background:var(--card-bg);
  border-radius:14px;
  box-shadow:0 12px 30px rgba(0,0,0,0.35);
}

h1{text-align:center;color:var(--primary);}
.subtitle{text-align:center;color:var(--muted);margin-bottom:30px;}

.toolbar{
  display:flex;
  gap:12px;
  justify-content:center;
  margin-bottom:20px;
}

button{
  padding:8px 16px;
  border:1px solid var(--border);
  background:#f4f6f8;
  border-radius:6px;
  cursor:pointer;
  font-family:inherit;
}

button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}

.progress{text-align:center;color:var(--muted);margin-bottom:20px;}

section{
  border:1px solid var(--border);
  border-radius:10px;
  margin-bottom:18px;
}

.section-header{
  padding:16px 20px;
  cursor:pointer;
  border-bottom:1px solid var(--border);
}

.section-header h2{margin:0;color:var(--primary);}

.section-content{padding:20px;display:none;}
section.open .section-content{display:block;}

.help{
  font-size:13px;
  color:var(--muted);
  margin-bottom:12px;
}

input{
  width:100%;
  padding:8px;
  margin-bottom:8px;
  border-radius:6px;
  border:1px solid var(--border);
  font-family:inherit;
}

.row{
  border:1px solid var(--border);
  border-radius:6px;
  padding:10px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<div id="watermark">DRAFT</div>

<div class="container">
<h1>My Estate Plan</h1>
<p class="subtitle">Personal estate planning record Â· Not a legal will</p>

<div class="toolbar">
  <button onclick="toggleStatus()">Draft / Final</button>
  <button onclick="window.print()">Print / PDF</button>
</div>

<div class="progress" id="progressText">Completion Status: 0%</div>

<!-- PERSONAL INFO -->
<section class="open">
<div class="section-header" onclick="toggle(this)"><h2>Personal Information</h2></div>
<div class="section-content">
<div class="help">Legal identification details used by executors and advisors.</div>
<input id="fullName" placeholder="Full legal name">
<input id="dob" placeholder="Date of birth">
<input id="address" placeholder="Primary address">
</div>
</section>

<!-- BENEFICIARIES -->
<section>
<div class="section-header" onclick="toggle(this)"><h2>Beneficiaries</h2></div>
<div class="section-content">
<div class="help">List individuals or organizations and what they are to receive.</div>
<div id="beneficiaries"></div>
<button onclick="addRow('beneficiaries',['Name','Relationship','Share or Item'])">Add Beneficiary</button>
</div>
</section>

<!-- ASSETS -->
<section>
<div class="section-header" onclick="toggle(this)"><h2>Assets</h2></div>
<div class="section-content">
<div class="help">Include property, accounts, vehicles, businesses, or valuables.</div>
<div id="assets"></div>
<button onclick="addRow('assets',['Category','Institution','Approx. Value'])">Add Asset</button>
</div>
</section>

<!-- DEBTS -->
<section>
<div class="section-header" onclick="toggle(this)"><h2>Debts & Obligations</h2></div>
<div class="section-content">
<div class="help">Outstanding obligations to be settled by the estate.</div>
<div id="debts"></div>
<button onclick="addRow('debts',['Creditor','Type','Approx. Balance'])">Add Debt</button>
</div>
</section>

</div>

<script>
const isTemplate = new URLSearchParams(window.location.search).get("template")==="true";
const STATUS_KEY="docStatus";
const dataKeys=["beneficiaries","assets","debts"];

function toggle(h){h.parentElement.classList.toggle("open");}

function getStatus(){
  return localStorage.getItem(STATUS_KEY)||"DRAFT";
}

function toggleStatus(){
  if(isTemplate) return;
  localStorage.setItem(STATUS_KEY,getStatus()==="DRAFT"?"FINAL":"DRAFT");
  applyStatus();
}

function applyStatus(){
  const final=getStatus()==="FINAL";
  document.getElementById("watermark").textContent=getStatus();
  document.querySelectorAll("input,button").forEach(el=>{
    if(el.textContent?.includes("Add")) el.disabled=final;
    if(el.tagName==="INPUT") el.readOnly=final;
  });
}

function addRow(key,fields){
  if(getStatus()==="FINAL") return;
  const list=JSON.parse(localStorage.getItem(key)||"[]");
  list.push({});
  localStorage.setItem(key,JSON.stringify(list));
  renderRows(key,fields);
}

function renderRows(key,fields){
  const wrap=document.getElementById(key);
  wrap.innerHTML="";
  const list=JSON.parse(localStorage.getItem(key)||"[]");
  list.forEach((row,i)=>{
    const d=document.createElement("div");
    d.className="row";
    fields.forEach(f=>{
      const inp=document.createElement("input");
      inp.placeholder=f;
      inp.value=row[f]||"";
      inp.oninput=()=>{
        row[f]=inp.value;
        list[i]=row;
        localStorage.setItem(key,JSON.stringify(list));
        updateProgress();
      };
      if(getStatus()==="FINAL") inp.readOnly=true;
      d.appendChild(inp);
    });
    wrap.appendChild(d);
  });
}

dataKeys.forEach(k=>{
  if(!isTemplate) renderRows(k,k==="beneficiaries"?["Name","Relationship","Share or Item"]:
    k==="assets"?["Category","Institution","Approx. Value"]:
    ["Creditor","Type","Approx. Balance"]);
});

function updateProgress(){
  let filled=0;
  document.querySelectorAll("input").forEach(i=>{if(i.value) filled++;});
  const total=document.querySelectorAll("input").length;
  document.getElementById("progressText").textContent=
    `Completion Status: ${Math.round((filled/total)*100)}%`;
}

if(isTemplate){
  localStorage.clear();
  document.getElementById("watermark").textContent="TEMPLATE";
}

applyStatus();
updateProgress();
</script>

</body>
</html>
