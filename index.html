<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Estate Planner Pro</title>

<style>
body{
  margin:0;
  font-family:"Times New Roman", Georgia, serif;
  background:#1a202c;
  min-height:100vh;
}
.container{
  max-width:1200px;
  margin:40px auto;
  padding:40px;
  background:#fff;
  border-radius:12px;
}
.topbar,.toolbar{
  display:grid;
  grid-template-columns:2fr 1fr 1fr;
  gap:10px;
  margin-bottom:12px;
}
.toolbar{grid-template-columns:repeat(auto-fit,minmax(120px,1fr))}
select,input,textarea,button{
  padding:10px;
  font-family:inherit;
}
button{cursor:pointer}
section{
  border:1px solid #e2e8f0;
  border-radius:8px;
  margin-top:16px;
}
.section-header{
  padding:14px;
  background:#f8fafc;
  cursor:pointer;
  font-weight:600;
}
.section-content{display:none;padding:14px}
section.open .section-content{display:block}
.progress-bar{
  height:4px;
  background:#e2e8f0;
  margin:16px 0;
}
.progress-fill{
  height:100%;
  background:#3b82f6;
  width:0%;
}
.progress-text{
  text-align:center;
  font-size:13px;
  color:#64748b;
}
.upgrade-notice{
  background:#fff3c4;
  padding:10px;
  border-radius:6px;
  font-weight:600;
}
</style>
</head>

<body>

<div class="container">

<h1 id="title">Estate Planner Pro</h1>
<div class="subtitle" id="subtitle">
Professional estate planning tool ‚Ä¢ Secure your legacy
</div>

<div class="topbar">
  <select id="country">
    <option>Canada</option>
    <option>United States</option>
    <option>France</option>
    <option>Germany</option>
    <option>Spain</option>
    <option>Japan</option>
    <option>China</option>
    <option>South Korea</option>
    <option>India</option>
  </select>

  <select id="language">
    <option value="en">EN</option>
    <option value="fr">FR</option>
    <option value="de">DE</option>
    <option value="es">ES</option>
    <option value="ja">JA</option>
    <option value="zh">‰∏≠Êñá</option>
    <option value="ko">KO</option>
    <option value="hi">HI</option>
  </select>

  <input value="Version 2.1 LANG + COUNTRY FIX" disabled />
</div>

<div class="toolbar">
  <button data-translate="openAll" onclick="openAll()">üìÇ Open All</button>
  <button data-translate="closeAll" onclick="closeAll()">üìÅ Close All</button>
  <button data-translate="print" onclick="window.print()">üñ®Ô∏è Print / PDF</button>
</div>

<div class="upgrade-notice" data-translate="upgradeNotice">
‚≠ê FREE TRIAL: You have 7 basic sections.
</div>

<div class="progress-bar">
  <div class="progress-fill" id="progressFill"></div>
</div>
<div class="progress-text" id="progressText">0% Complete</div>

<section class="open">
  <div class="section-header" data-translate="personalInfo" onclick="toggle(this)">
    üìã Personal Information
  </div>
  <div class="section-content">
    <input placeholder="Full legal name" oninput="updateProgress()"><br><br>
    <input placeholder="Date of birth" oninput="updateProgress()">
  </div>
</section>

<section>
  <div class="section-header" data-translate="executors" onclick="toggle(this)">
    ‚öñÔ∏è Executors
  </div>
  <div class="section-content">
    <input placeholder="Executor name" oninput="updateProgress()">
  </div>
</section>

</div>

<script>
console.log("Estate Planner Pro v2.1 ‚Äì COUNTRY + LANGUAGE FIX LOADED");

/* =====================================================
   LANGUAGE SYSTEM (CORRECT CONTROL FLOW)
===================================================== */

let currentLang = "en";
let userSelectedLanguage = false;

/* Country ‚Üí Language mapping */
const countryLang = {
  "Canada":"en",
  "United States":"en",
  "France":"fr",
  "Germany":"de",
  "Spain":"es",
  "Japan":"ja",
  "China":"zh",
  "South Korea":"ko",
  "India":"hi"
};

/* Translations */
const T = {
  en:{
    title:"Estate Planner Pro",
    subtitle:"Professional estate planning tool ‚Ä¢ Secure your legacy",
    upgradeNotice:"‚≠ê FREE TRIAL: You have 7 basic sections.",
    openAll:"üìÇ Open All",
    closeAll:"üìÅ Close All",
    print:"üñ®Ô∏è Print / PDF",
    personalInfo:"üìã Personal Information",
    executors:"‚öñÔ∏è Executors",
    complete:"Complete",
    fields:"fields"
  },
  fr:{
    title:"Planificateur Successoral Pro",
    subtitle:"Outil professionnel de planification successorale",
    upgradeNotice:"‚≠ê ESSAI GRATUIT : 7 sections de base",
    openAll:"üìÇ Tout Ouvrir",
    closeAll:"üìÅ Tout Fermer",
    print:"üñ®Ô∏è Imprimer / PDF",
    personalInfo:"üìã Informations personnelles",
    executors:"‚öñÔ∏è Ex√©cuteurs testamentaires",
    complete:"Termin√©",
    fields:"champs"
  },
  de:{
    title:"Nachlassplaner Pro",
    subtitle:"Professionelles Nachlassplanungstool",
    upgradeNotice:"‚≠ê KOSTENLOSE TESTVERSION",
    openAll:"üìÇ Alle √ñffnen",
    closeAll:"üìÅ Alle Schlie√üen",
    print:"üñ®Ô∏è Drucken / PDF",
    personalInfo:"üìã Pers√∂nliche Informationen",
    executors:"‚öñÔ∏è Testamentsvollstrecker",
    complete:"Fertig",
    fields:"Felder"
  }
};

/* Apply language */
function applyLanguage(lang){
  currentLang = T[lang] ? lang : "en";
  document.getElementById("language").value = currentLang;
  const tr = T[currentLang];

  document.getElementById("title").textContent = tr.title;
  document.getElementById("subtitle").textContent = tr.subtitle;

  document.querySelectorAll("[data-translate]").forEach(el=>{
    const key = el.dataset.translate;
    if(tr[key]) el.textContent = tr[key];
  });

  updateProgress();
}

/* Country ‚Üí Language (RESET override) */
function applyLanguageFromCountry(country){
  userSelectedLanguage = false;
  applyLanguage(countryLang[country] || "en");
}

/* Progress */
function updateProgress(){
  const inputs = document.querySelectorAll("input:not([disabled]), textarea");
  const filled = [...inputs].filter(i=>i.value.trim()).length;
  const total = inputs.length;
  const percent = Math.round((filled/total)*100 || 0);

  document.getElementById("progressFill").style.width = percent+"%";
  document.getElementById("progressText").textContent =
    `${percent}% ${T[currentLang].complete} (${filled}/${total} ${T[currentLang].fields})`;
}

/* UI */
function toggle(h){h.parentElement.classList.toggle("open")}
function openAll(){document.querySelectorAll("section").forEach(s=>s.classList.add("open"))}
function closeAll(){document.querySelectorAll("section").forEach(s=>s.classList.remove("open"))}

/* INIT */
document.addEventListener("DOMContentLoaded",()=>{
  const country = document.getElementById("country");
  const language = document.getElementById("language");

  country.addEventListener("change",()=>{
    applyLanguageFromCountry(country.value);
  });

  language.addEventListener("change",()=>{
    userSelectedLanguage = true;
    applyLanguage(language.value);
  });

  applyLanguageFromCountry(country.value);
});
</script>

</body>
</html>
