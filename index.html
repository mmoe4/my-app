<!--
Estate Planner Pro
Version 2.1 â€“ FINAL Country + Language Fix
-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estate Planner Pro</title>

<style>
/* (CSS unchanged â€“ omitted here for brevity in explanation)
   KEEP YOUR EXISTING CSS EXACTLY AS-IS */
</style>
</head>

<body>

<div class="container">

<h1 id="title">Estate Planner Pro</h1>
<div class="subtitle" id="subtitle">
Professional estate planning tool â€¢ Secure your legacy
</div>

<div class="topbar">
  <select id="country">
    <option>Canada</option>
    <option>United States</option>
    <option>France</option>
    <option>Germany</option>
    <option>Spain</option>
    <option>Japan</option>
    <option>China</option>
    <option>South Korea</option>
    <option>India</option>
  </select>

  <select id="language">
    <option value="en">EN</option>
    <option value="fr">FR</option>
    <option value="de">DE</option>
    <option value="es">ES</option>
    <option value="ja">JA</option>
    <option value="zh">ä¸­æ–‡</option>
    <option value="ko">KO</option>
    <option value="hi">HI</option>
  </select>

  <input value="Version 2.1 FINAL" disabled>
</div>

<div class="toolbar">
  <button data-translate="openAll" onclick="openAll()">ğŸ“‚ Open All</button>
  <button data-translate="closeAll" onclick="closeAll()">ğŸ“ Close All</button>
  <button data-translate="print" onclick="window.print()">ğŸ–¨ï¸ Print / PDF</button>
</div>

<div class="upgrade-notice" data-translate="upgradeNotice">
â­ FREE TRIAL: You have 7 basic sections.
</div>

<div class="progress-bar">
  <div class="progress-fill" id="progressFill"></div>
</div>
<div class="progress-text" id="progressText">0% Complete</div>

</div>

<script>
/* =====================================================
   SINGLE SOURCE OF TRUTH â€” LANGUAGE SYSTEM
===================================================== */

let currentLang = "en";
let userSelectedLanguage = false;

const countryLang = {
  Canada:"en",
  "United States":"en",
  France:"fr",
  Germany:"de",
  Spain:"es",
  Japan:"ja",
  China:"zh",
  "South Korea":"ko",
  India:"hi"
};

const T = {
  en:{
    title:"Estate Planner Pro",
    subtitle:"Professional estate planning tool â€¢ Secure your legacy",
    upgradeNotice:"â­ FREE TRIAL: You have 7 basic sections.",
    openAll:"ğŸ“‚ Open All",
    closeAll:"ğŸ“ Close All",
    print:"ğŸ–¨ï¸ Print / PDF",
    complete:"Complete",
    fields:"fields"
  },
  fr:{
    title:"Planificateur Successoral Pro",
    subtitle:"Outil professionnel de planification successorale",
    upgradeNotice:"â­ ESSAI GRATUIT : 7 sections de base",
    openAll:"ğŸ“‚ Tout Ouvrir",
    closeAll:"ğŸ“ Tout Fermer",
    print:"ğŸ–¨ï¸ Imprimer / PDF",
    complete:"TerminÃ©",
    fields:"champs"
  },
  de:{
    title:"Nachlassplaner Pro",
    subtitle:"Professionelles Nachlassplanungstool",
    upgradeNotice:"â­ KOSTENLOSE TESTVERSION",
    openAll:"ğŸ“‚ Alle Ã–ffnen",
    closeAll:"ğŸ“ Alle SchlieÃŸen",
    print:"ğŸ–¨ï¸ Drucken / PDF",
    complete:"Fertig",
    fields:"Felder"
  }
};

/* Apply language */
function applyLanguage(lang){
  currentLang = T[lang] ? lang : "en";
  document.getElementById("language").value = currentLang;
  const tr = T[currentLang];

  document.getElementById("title").textContent = tr.title;
  document.getElementById("subtitle").textContent = tr.subtitle;

  document.querySelectorAll("[data-translate]").forEach(el=>{
    const key = el.dataset.translate;
    if(tr[key]) el.textContent = tr[key];
  });

  updateProgress();
}

/* Country controls language */
function applyFromCountry(country){
  userSelectedLanguage = false;
  applyLanguage(countryLang[country] || "en");
}

/* INIT */
document.addEventListener("DOMContentLoaded",()=>{
  const country = document.getElementById("country");
  const language = document.getElementById("language");

  country.addEventListener("change",()=>{
    applyFromCountry(country.value);
  });

  language.addEventListener("change",()=>{
    userSelectedLanguage = true;
    applyLanguage(language.value);
  });

  // Initial load: COUNTRY decides language
  applyFromCountry(country.value);
});
</script>

</body>
</html>
